(function(a){a.fn.llskala=function(b){var b=a.extend({bleed:false,margin:0,align:"center",valign:"center"},b);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;c=a(this);d=c.width();e=c.height();l=d/e;if(b.bleed){j=Math.floor(d);k=Math.floor(e)}else{j=Math.round(d)-b.margin*2;k=Math.round(e)-b.margin*2}h=c.children();h.each(function(c){i=a(this);f=Math.round(i.width());g=Math.round(i.height());m=f/g;q={left:0,top:0};if(b.bleed){if(l>=1){if(m>=1){rw=f/d;rh=g/e;if(rw>rh){n=e/g;o=Math.round(f*n);p=k}else{n=d/f;p=Math.round(g*n);p<e?p=e+2:p=p;o=j}}else{n=d/f;p=Math.round(g*n);p<e?p=e+2:p=p;o=j}}else{if(m>=1){n=e/g;o=Math.round(f*n);o<d?o=d+2:o=o;p=k}else{rw=f/j;rh=g/k;if(rw>rh){n=e/g;o=Math.round(f*n);p=k}else{n=d/f;p=Math.round(g*n);o=j}}}if(b.align=="center"){if(o>d)a.extend(q,{left:"-"+Math.round((o-d)/2)+"px"})}else if(b.align=="right"){if(o>d)a.extend(q,{left:"-"+(Math.round(o-d)-b.margin)+"px"})}if(b.valign=="center"){if(p>e)a.extend(q,{top:"-"+Math.round((p-e)/2)+"px"})}else if(b.valign=="bottom"){if(p>e)a.extend(q,{top:"-"+(Math.round(p-e)-b.margin)+"px"})}}else{if(l>=1){if(m>=1){rw=f/j;rh=g/k;if(rw>rh){n=j/f;p=Math.round(g*n);o=j}else{n=k/g;o=Math.round(f*n);p=k}}else{n=k/g;o=Math.round(f*n);p=k}}else{if(m>=1){n=j/f;p=Math.round(g*n);o=j}else{rw=f/j;rh=g/k;if(rw>rh){n=j/f;p=Math.round(g*n);o=j}else{n=k/g;o=Math.round(f*n);p=k}}}if(b.align=="center"){if(d>=o)a.extend(q,{left:Math.round((d-o)/2)+"px"})}else if(b.align=="right"){if(d>=o)a.extend(q,{left:Math.round(d-o)-b.margin+"px"})}if(b.valign=="center"){if(e>=p)a.extend(q,{top:Math.round((e-p)/2)+"px"})}else if(b.valign=="bottom"){if(e>=p)a.extend(q,{top:Math.round(e-p)-b.margin+"px"})}}i.width(o).height(p).css(q)})}})(jQuery)